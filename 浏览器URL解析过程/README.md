## 浏览器URL解析过程

- 1.输入URL浏览器进行DNS查询
    - 1.1 DNS概念
        - 1.1.1 域名系统（Domain Name System）是一种用于TCP/IP应用程序的分布式数据库，它提供主机名字和IP地址之间的转换.
    - 1.2 为什么要用DNS解析
        - 1.2.1 网络通讯大部分是基于TCP/IP的，而TCP/IP是基于IP地址的，所以计算机在网络上进行通讯时只能识别如“202.96.134.133”之类的IP地址，而不能认识域名.
    - 1.3 DNS解析过程
        - 1.3.1   ![avatar](https://github.com/ai4code/study/blob/master/%E6%B5%8F%E8%A7%88%E5%99%A8URL%E8%A7%A3%E6%9E%90%E8%BF%87%E7%A8%8B/image/dns.jpg)

- 2.建立TCP连接发送服务端请求
    - 2.1 通过DNS得到Web服务器的真实IP地址后,通过与TCP创建三次握手,浏览器像web服务器发送请求。具体步骤
        - 2.1.1 浏览器缓存: 如果存在，则解析过程结束
        - 2.1.2 系统缓存: 如果浏览器未缓存，浏览器会检查操作系统缓存中是否有这个这个域名对应的ip地址
        - 2.1.3 路由器缓存: 若本机中没有解析到，则将请求发送给路由器
        - 2.1.4 DNS提供商缓存: 若仍未解析到，则检查TCP/IP中设置的DNS服务器，将URL发送给DNS服务器，最终返回域名的Ip地址
    - 2.2 TCP三次握手
        - 2.2.1 起初两端都处于CLOSED关闭状态，Client将标志位SYN置为1，随机产生一个值seq=x，并将该数据包发送给Server，Client进入SYN-SENT状态，等待Server确认
        - 2.2.2 Server收到数据包后由标志位SYN=1得知Client请求建立连接，Server将标志位SYN和ACK都置为1，ack=x+1，随机产生一个值seq=y，并将该数据包发送给Client以确认连接请求，Server进入SYN-RCVD状态，此时操作系统为该TCP连接分配TCP缓存和变量
        - 2.2.3 Client收到确认后，检查ack是否为x+1，ACK是否为1，如果正确则将标志位ACK置为1，ack=y+1，并且此时操作系统为该TCP连接分配TCP缓存和变量，并将该数据包发送给Server，Server检查ack是否为y+1，ACK是否为1，如果正确则连接建立成功，Client和Server进入ESTABLISHED状态，完成三次握手，随后Client和Server就可以开始传输数据
    - 2.3 扩展-TCP四次挥手
        - 2.3.1 A的应用进程先向其TCP发出连接释放报文段（FIN=1，序号seq=u），并停止再发送数据，主动关闭TCP连接，进入FIN-WAIT-1（终止等待1）状态，等待B的确认
        - 2.3.2 B收到连接释放报文段后即发出确认报文段，（ACK=1，确认号ack=u+1，序号seq=v），B进入CLOSE-WAIT（关闭等待）状态，此时的TCP处于半关闭状态，A到B的连接释放
        - 2.3.3 A收到B的确认后，进入FIN-WAIT-2（终止等待2）状态，等待B发出的连接释放报文段。
        - 2.3.4 B没有要向A发出的数据，B发出连接释放报文段（FIN=1，ACK=1，序号seq=w，确认号ack=u+1），B进入LAST-ACK（最后确认）状态，等待A的确认
        - 2.3.5 A收到B的连接释放报文段后，对此发出确认报文段（ACK=1，seq=u+1，ack=w+1），A进入TIME-WAIT（时间等待）状态。此时TCP未释放掉，需要经过时间等待计时器设置的时间2MSL后，A才进入CLOSED状态。
        - 2.3.6  状态码
            - 2.3.6.1 1**	信息，服务器收到请求，需要请求者继续执行操作
            - 2.3.6.2 2**	成功，操作被成功接收并处理
            - 2.3.6.3 3**	重定向，需要进一步的操作以完成请求
            - 2.3.6.4 4**	客户端错误，请求包含语法错误或无法完成请求
            - 2.3.6.5 5**	服务器错误，服务器在处理请求的过程中发生了错误

- 3. 服务器的永久重定向响应返回真正访问的地址 
    - 3.1 服务器给浏览器响应一个 301 永久重定向响应，这样浏览器就会访问 http://www.facebook.com/ 而非 http://facebook.com/. 重定向的目的：搜索引擎会认为它们是两个网站，结果造成每一个的搜索链接都减少从而降低排名
- 4.浏览器跟踪重定向地址另发一个http请求
- 5.服务器处理请求
    - 5.1 服务器接收到获取请求，然后处理并返回一个响应
- 6.服务器返回一个http响应结果    
- 7.浏览器解析html页面
    - 7.1 构建dom树 ->构建render树 -> 布局render树 ->绘制render树 
    - 7.2 将HTML构建成一个DOM树（DOM = Document Object Model 文档对象模型），DOM 树的构建过程是一个深度遍历过程：当前节点的所有子节点都构建好后才会去构建当前节点的下一个兄弟节点 
    - 7.3 将CSS解析成CSS去构造CSSOM树( CSSOM = CSS Object Model CSS对象模型)
    - 7.4 根据DOM树和CSSOM来构造 Rendering Tree（渲染树）。
    - 7.5 浏览器根据Render Tree定义以及他们的从属关系
    - 7.6 计算每个节点位于屏幕中的位置
    - 7.7 遍历render树绘制每个节点
